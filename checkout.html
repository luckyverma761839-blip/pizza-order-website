<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Checkout</title>

<style>
body{
 font-family:Arial;
 background:#fff3e0;
 text-align:center;
}
.card{
 background:#fff;
 width:320px;
 margin:auto;
 padding:15px;
 border-radius:12px;
}
input,button{
 width:90%;
 padding:10px;
 margin:6px;
 font-size:16px;
}
button{
 background:#e23744;
 color:white;
 border:none;
 border-radius:8px;
}
#loc{
 font-size:14px;
 color:green;
}
</style>
</head>

<body>

<h2>üìç Delivery Details</h2>

<div class="card">
<input id="custName" placeholder="Name" required>
<input id="mobile" placeholder="Mobile" required>
<input id="address" placeholder="Full Address" required>

<p id="loc">‚ùå Location not shared</p>
<button onclick="getLoc()">üìç Share Live Location</button><br><br>

<button onclick="placeOrder()">‚úÖ Place Order</button>
</div>

<script>
let lat = "";
let lon = "";

/* LOCATION */
function getLoc(){
 if(!navigator.geolocation){
  alert("Location not supported");
  return;
 }

 navigator.geolocation.getCurrentPosition(
  pos=>{
   lat = pos.coords.latitude;
   lon = pos.coords.longitude;
   document.getElementById("loc").innerText =
    "‚úÖ Location shared";
  },
  err=>{
   alert("Location allow karo");
  }
 );
}

/* ORDER */
function placeOrder(){

 if(lat=="" || lon==""){
  alert("Pehle location share karo");
  return;
 }

 let name = document.getElementById("custName").value;
 let mobile = document.getElementById("mobile").value;
 let address = document.getElementById("address").value;

 if(name=="" || mobile=="" || address==""){
  alert("Sab fields bharo");
  return;
 }

 let cart = JSON.parse(localStorage.getItem("cart")) || {};
 let total = localStorage.getItem("total") || 0;

 let orderTxt = "";
 for(let item in cart){
  if(cart[item]>0){
   orderTxt += `${item} x ${cart[item]}, `;
  }
 }

 let mapLink = `https://maps.google.com/?q=${lat},${lon}`;

 /* WHATSAPP */
 let msg =
`üçΩ Lucky Food Order
Name: ${name}
Mobile: ${mobile}
Address: ${address}
Order: ${orderTxt}
Total: ‚Çπ${total}
Map: ${mapLink}`;

 window.open(
  "https://wa.me/919548104387?text=" +
  encodeURIComponent(msg)
 );

 /* GOOGLE FORM ‚Üí SHEET */
 fetch(
 "https://docs.google.com/forms/d/e/1FAIpQLSedR_Ae58hNDBIL_GoxyiugBy1UDNC7egNB7ZLGy9Jl-qIFWg/formResponse",
 {
  method:"POST",
  mode:"no-cors",
  body:new URLSearchParams({
   "entry.305816801": name,
   "entry.939920568": mobile,
   "entry.1721748407": address,
   "entry.1630372635": orderTxt,
   "entry.912633813": total,
   "entry.515021196": lat + "," + lon
  })
 });

}
</script>

</body>
</html>
